# üõí Pterodactyl Shop System Addon - Installation Guide

**Version:** 1.3.0  
**Compatible with:** Pterodactyl Panel v1.11.0+  
**License:** MIT

> **‚ö†Ô∏è Important:** This is an addon for existing Pterodactyl Panel installations. You must have a working Pterodactyl Panel before installing this shop system.

---

## üìã **What You'll Get**

This addon adds a complete shop and billing system to your existing Pterodactyl Panel:
- üõí **Product catalog** with categories and plans
- üí≥ **Payment processing** (Stripe, PayPal)
- üë§ **Customer management** and orders
- üßæ **Invoice generation** (PDF)
- üí∞ **Wallet system** with balance tracking
- üìä **Admin dashboard** with analytics

---

## üîß **Prerequisites**

### **Required: Working Pterodactyl Panel**
- ‚úÖ **Pterodactyl Panel v1.11.0+** already installed and working
- ‚úÖ **Admin access** to your panel
- ‚úÖ **SSH/Terminal access** to your server
- ‚úÖ **File upload capability** (FTP/SFTP/direct access)

### **Verify Your Current Setup**
```bash
# Navigate to your Pterodactyl directory
cd /var/www/pterodactyl  # (or wherever your panel is installed)

# Check Pterodactyl version
php artisan --version

# Check PHP version (must be 8.1+)
php -v

# Verify composer works
composer --version

# Check database connection
php artisan migrate:status
```

### **What We'll Install**
The shop addon will add these dependencies to your panel:
- `stripe/stripe-php: ^10.0` - Stripe payment processing
- `paypal/paypal-checkout-sdk: ^1.0` - PayPal payment processing
- `ramsey/uuid: ^4.0` - Unique identifier generation

---

## üöÄ **Installation Steps**

### **Step 1: Upload Addon Files**

Extract the shop-system addon to your Pterodactyl installation:

```bash
# Navigate to your Pterodactyl directory
cd /var/www/pterodactyl

# Create addons directory if it doesn't exist
mkdir -p addons

# Upload the shop-system folder to: /var/www/pterodactyl/addons/shop-system/
# Your file structure should look like:
# /var/www/pterodactyl/
# ‚îú‚îÄ‚îÄ addons/
# ‚îÇ   ‚îî‚îÄ‚îÄ shop-system/
# ‚îÇ       ‚îú‚îÄ‚îÄ src/
# ‚îÇ       ‚îú‚îÄ‚îÄ resources/
# ‚îÇ       ‚îú‚îÄ‚îÄ config/
# ‚îÇ       ‚îú‚îÄ‚îÄ database/
# ‚îÇ       ‚îú‚îÄ‚îÄ routes/
# ‚îÇ       ‚îú‚îÄ‚îÄ composer.json
# ‚îÇ       ‚îî‚îÄ‚îÄ VERSION
# ‚îú‚îÄ‚îÄ app/
# ‚îú‚îÄ‚îÄ config/
# ‚îî‚îÄ‚îÄ ... (your existing panel files)
```

### **Step 2: Run One-Click Installer**

**That's it! One command does everything:**

```bash
# Navigate to your Pterodactyl root directory
cd /var/www/pterodactyl

# Run the one-click installer (handles everything automatically)
php artisan shop:install

# If you need to reinstall or force install:
php artisan shop:install --force
```

**What the installer does automatically:**
- ‚úÖ **Verifies prerequisites** (PHP version, database connection)
- ‚úÖ **Installs dependencies** (Stripe, PayPal, UUID packages)
- ‚úÖ **Configures autoloader** (adds PSR-4 mapping to composer.json)
- ‚úÖ **Registers service provider** (adds to config/app.php)
- ‚úÖ **Resolves route conflicts** (fixes base route patterns)
- ‚úÖ **Runs database migrations** (creates 15+ shop tables)
- ‚úÖ **Publishes configuration** (copies config files)
- ‚úÖ **Seeds default data** (creates initial settings)
- ‚úÖ **Clears all caches** (ensures changes take effect)
- ‚úÖ **Verifies installation** (confirms everything works)

**Expected Output:**
```
üöÄ Starting Pterodactyl Shop System One-Click Installation...

üîç Verifying prerequisites...
   ‚úÖ Prerequisites verified
üîç Verifying addon structure...
   ‚úÖ Addon structure verified
ÔøΩ Installing required dependencies...
   Installing stripe/stripe-php:^10.0...
   Installing paypal/paypal-checkout-sdk:^1.0...
   Installing ramsey/uuid:^4.0...
   ‚úÖ Dependencies installed
ÔøΩüîß Configuring autoloader...
   ‚úÖ Autoloader configured
üîß Registering service provider...
   ‚úÖ Service provider registered
ÔøΩÔ∏è Resolving route conflicts...
   ‚úÖ Route conflicts resolved
üîÑ Refreshing autoloader...
   ‚úÖ Autoloader refreshed
ÔøΩüìä Running database migrations...
   ‚úÖ Database migrations completed
üìÅ Publishing configuration...
   ‚úÖ Configuration published
üå± Creating default shop settings...
   ‚úÖ Default settings created
üßπ Clearing application caches...
   ‚úÖ Caches cleared
‚úÖ Verifying installation...
   ‚úÖ Installation verified

üéâ Shop System installed successfully!

üìä Admin Dashboard: https://yourpanel.com/admin/shop
üõí Customer Shop: https://yourpanel.com/shop

üí° Next steps:
   1. Visit admin dashboard to configure shop settings
   2. Set up payment gateways (Stripe/PayPal)  
   3. Create product categories and plans
   4. Test the checkout process
```

---

## ‚öôÔ∏è **Configuration**

### **Step 1: Basic Shop Settings**

Add these environment variables to your `.env` file:

```bash
# Enable the shop system
SHOP_ENABLED=true
SHOP_MAINTENANCE=false

# Shop branding
SHOP_NAME="Your Server Shop"
SHOP_CURRENCY=USD
SHOP_CURRENCY_SYMBOL=$

# Optional: Custom styling
SHOP_PRIMARY_COLOR=#0ea5e9
```

### **Step 2: Payment Gateway Setup**

**Choose and configure at least one payment method:**

#### **Option A: Stripe (Recommended)**
```bash
# Add to your .env file:
STRIPE_ENABLED=true
STRIPE_PUBLISHABLE_KEY=pk_test_your_key_here
STRIPE_SECRET_KEY=sk_test_your_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
```

1. Create account at https://stripe.com
2. Get API keys from Dashboard ‚Üí Developers ‚Üí API keys
3. Create webhook: `https://yourpanel.com/shop/webhooks/stripe`
4. Add events: `payment_intent.succeeded`, `payment_intent.payment_failed`

#### **Option B: PayPal**
```bash
# Add to your .env file:
PAYPAL_ENABLED=true
PAYPAL_MODE=sandbox  # or 'live' for production
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret
```

1. Create developer account at https://developer.paypal.com
2. Create new app (sandbox or live)
3. Get Client ID and Client Secret
4. Return URL: `https://yourpanel.com/shop/payment/paypal/return`
5. Cancel URL: `https://yourpanel.com/shop/payment/paypal/cancel`

### **Step 3: Shop Configuration**

1. **Access Admin Dashboard:** `https://yourpanel.com/admin/shop`

2. **Configure General Settings:**
   - Shop name and description
   - Currency and formatting
   - Terms of service URL

3. **Set Up Payment Methods:**
   - Enable your chosen payment gateways
   - Set processing fees if needed
   - Test payment connections

4. **Create Product Categories:**
   - Examples: "Game Servers", "VPS Hosting", "Add-ons"
   - Set descriptions and display order

5. **Add Your First Products:**
   - Create hosting plans with resource limits
   - Set pricing and billing cycles
   - Configure server creation settings

---

## üéØ **Post-Installation**

### **Set Up Admin Access**
Ensure your admin user can access the shop dashboard:

```bash
# Make sure your user is a root admin
php artisan tinker --execute "
\$user = \Pterodactyl\Models\User::where('email', 'your@email.com')->first();
\$user->root_admin = 1;
\$user->save();
echo 'Admin access granted to: ' . \$user->email;
"
```

### **Optional: Background Processing**
For better performance with large order volumes:

```bash
# Add to your crontab
crontab -e

# Add this line:
* * * * * cd /var/www/pterodactyl && php artisan schedule:run >> /dev/null 2>&1

# For production, run queue worker:
php artisan queue:work --daemon
```

### **SSL Certificate (Required for Payments)**
Ensure HTTPS is properly configured:

```bash
# Example with Certbot
certbot --nginx -d yourpanel.com
```

---

## üõ†Ô∏è **Troubleshooting**

### **If Installation Fails**

The one-click installer handles most issues automatically, but if something goes wrong:

```bash
# Try force reinstall (fixes most issues)
php artisan shop:install --force

# Check the error output for specific issues
# Most common problems are resolved automatically
```

### **Common Issues**

#### **1. "Prerequisites verification failed"**
```bash
# Check PHP version (must be 8.1+)
php -v

# Check database connection
php artisan migrate:status

# Ensure you're in the Pterodactyl root directory
ls artisan  # Should exist
```

#### **2. "Addon structure not found"** 
```bash
# Verify addon files are in the right place
ls -la addons/shop-system/

# Should show: src/, resources/, config/, database/, etc.
```

#### **3. "Dependency installation failed"**
```bash
# Check composer is working
composer --version

# Check internet connection for package downloads
ping packagist.org

# Try manual dependency installation
composer require stripe/stripe-php:^10.0 --no-interaction
```

#### **4. "Permission denied" errors**
```bash
# Fix file permissions
sudo chown -R www-data:www-data /var/www/pterodactyl
sudo chmod -R 755 /var/www/pterodactyl

# Or for your user:
sudo chown -R $USER:$USER /var/www/pterodactyl
```

### **Manual Verification**

If you want to check everything manually:

```bash
# Check if shop commands exist
php artisan list | grep shop

# Check if database tables were created  
php artisan tinker --execute "
echo 'Tables: ';
echo Schema::hasTable('shop_settings') ? '‚úÖ shop_settings' : '‚ùå shop_settings';
echo Schema::hasTable('shop_orders') ? ' ‚úÖ shop_orders' : ' ‚ùå shop_orders';
echo Schema::hasTable('user_wallets') ? ' ‚úÖ user_wallets' : ' ‚ùå user_wallets';
"

# Check if routes work
curl -I http://localhost/shop  # Should return 200, not 404

# Check if config is published
ls -la config/shop.php  # Should exist
```

### **Get Help**

If you're still having issues:

1. **Check logs:** `tail -f storage/logs/laravel.log`
2. **Enable debug:** Add `APP_DEBUG=true` to `.env`
3. **Try fresh install:** Remove addon files and reinstall
4. **Check permissions:** Ensure web server can read/write files

The one-click installer is designed to handle 99% of installation scenarios automatically!

---

## üóëÔ∏è **Uninstallation**

If you need to remove the shop system:

```bash
# Remove addon but keep database data
php artisan shop:uninstall --keep-data

# Complete removal (‚ö†Ô∏è DESTRUCTIVE - removes all shop data)
php artisan shop:uninstall --force

# Remove addon files
rm -rf addons/shop-system/

# Clean up configuration
rm -f config/shop.php

# Clear caches
php artisan config:clear
php artisan route:clear
php artisan view:clear
composer dump-autoload -o
```

---

## üìû **Support & Resources**

### **Getting Started**
1. üìä **Admin Dashboard:** `https://yourpanel.com/admin/shop`
2. üõí **Shop Frontend:** `https://yourpanel.com/shop`
3. üìñ **Built-in Documentation:** Available in admin dashboard

### **Useful Commands**
```bash
# Check system status
php artisan shop:status

# Clean up old orders
php artisan shop:cleanup-cancelled

# Fix wallet balance issues
php artisan shop:fix-wallet-balances

# View all shop routes
php artisan route:list | grep shop
```

### **File Structure (After Installation)**
```
/var/www/pterodactyl/
‚îú‚îÄ‚îÄ addons/
‚îÇ   ‚îî‚îÄ‚îÄ shop-system/          # Your addon files
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ shop.php             # Published configuration
‚îú‚îÄ‚îÄ storage/logs/
‚îÇ   ‚îî‚îÄ‚îÄ laravel.log          # Check for errors here
‚îî‚îÄ‚îÄ ... (existing panel files)
```

---

## üéâ **You're All Set!**

Your Pterodactyl Panel now has a complete shop system! 

### **What Just Happened:**
‚úÖ **One Command Installation** - Everything configured automatically  
‚úÖ **Zero Manual Configuration** - No file editing required  
‚úÖ **All Dependencies Installed** - Stripe, PayPal, and PDF support  
‚úÖ **Database Ready** - 15+ tables created and configured  
‚úÖ **Routes Working** - Shop accessible at `/shop`  
‚úÖ **Admin Dashboard** - Full management interface at `/admin/shop`

### **Installation Summary:**
```bash
# That's literally all you needed to do:
cd /var/www/pterodactyl
# (upload addon files to addons/shop-system/)
php artisan shop:install
```

**Next Steps:**
1. üîê **Login to admin dashboard** ‚Üí `https://yourpanel.com/admin/shop`
2. ‚öôÔ∏è **Configure payment gateways** ‚Üí Set up Stripe or PayPal
3. üõí **Create your first products** ‚Üí Add categories and hosting plans
4. üí≥ **Test checkout process** ‚Üí Make sure payments work
5. üöÄ **Start selling!** ‚Üí Your shop is ready for customers

**Quick Access Links:**
- **üéõÔ∏è Admin Dashboard:** `https://yourpanel.com/admin/shop`
- **üõí Customer Shop:** `https://yourpanel.com/shop`  
- **üìã Order Management:** `https://yourpanel.com/admin/shop/orders`
- **üí∞ Financial Reports:** `https://yourpanel.com/admin/shop/analytics`

---

**Version:** 1.3.0 | **Last Updated:** September 17, 2025